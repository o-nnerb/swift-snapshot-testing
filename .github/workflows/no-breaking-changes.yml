name: No API Breaking Changes

on:
  pull_request:
    branches: [main]
    paths:
      - 'Package.swift'
      - 'Sources/**'
      - '.github/workflows/no-breaking-changes.yml'

jobs:
  breaking-changes:
    runs-on: macOS-latest
    name: Checking API Breaking Changes
    steps:
      - name: ☑️ Xcode Select
        run: sudo Xcode-select -switch /Applications/Xcode_16.4.app

      - name: ⬇️ Get Sources
        uses: actions/checkout@v4.2.2
        with:
          fetch-depth: 0

      - name: 💔 Checking API Breaking Changes
        run: |
          latest_tag=$(git describe --tags --abbrev=0)
          echo "Checking breaking changes for $latest_tag"
          swift package diagnose-api-breaking-changes $latest_tag
